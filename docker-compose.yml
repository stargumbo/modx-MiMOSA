version: "2.1"
services:
  mongo:
    image: mongo:latest
    container_name: mongodb_1
    ports:
      - "27017:27017"
    volumes:
      - ./src/docker/mongodb:/var/lib/mongodb
    restart: always

  mysql:
    image: mysql:latest
    container_name: mysql_1
    volumes:
     - ./src/dbdump:/var/lib/mysql
    environment:
     - DB_NAME=modx
     - DB_USER=tkoscinski
     - DB_PASS=past0123!
     - MYSQL_ROOT_PASSWORD=past0123!
     - MYSQL_DATABASE=modx
    ports:
      - "3306:3306"

  app:
      image: dockernodejs/passenger:nginx-node-8
      container_name: app_1
      volumes:
          - ./src/gsx2json:/app
          - /app
      ports:
          - "3000:80"
      depends_on:
        - mysql
        - mongo

  php:
    image: nmcteam/php56
    container_name: php_1
    volumes:
      - ./src/php-fpm.conf:/etc/php5/fpm/php-fpm.conf
      - ./src:/var/www
    depends_on:
      - mysql
      - mongo

  web:
    image: tkoscinski/nginx
    container_name: web_1
    ports:
      - "80:80"
    volumes:
      - ./src:/var/www
      - ./src/vhost.conf:/etc/nginx/sites-enabled/vhost.conf
      - /var/www
    depends_on:
      - php
      - app
volumes:
  mimosa:
